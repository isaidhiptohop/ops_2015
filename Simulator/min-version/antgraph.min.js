function reset(){var e=600,n=550;d3.select("svg").remove();var t=d3.select("#simulator").append("svg").attr("id","chart").attr("width",e).attr("height",n),s=e/2,l=50,a=[{id:0,type:2,x:s,y:l},{id:1,type:1,x:s,y:l+450}],r=[];graph=new AntGraph(t,a,r),graph.setIdCt(2),graph.updateGraph(),d3.select("#next-step").attr("disabled","disabled")}var AntGraph=function(e,n,t){var s=this;s.idct=0,s.nodes=n||[],s.edges=t||[],s.state={selectedNode:null,selectedEdge:null,mouseDownNode:null,mouseDownLink:null,justDragged:!1,justScaleTransGraph:!1,lastKeyDown:-1,shiftNodeDrag:!1,selectedText:null,simulationStarted:!1},s.svg=e,s.svgG=e.append("g").classed(s.consts.graphClass,!0);var l=s.svgG;s.dragLine=l.append("svg:path").attr("class","link dragline hidden").attr("d","M0,0L0,0"),s.paths=l.append("g").selectAll("g"),s.circles=l.append("g").selectAll("g"),s.drag=d3.behavior.drag().origin(function(e){return{x:e.x,y:e.y}}).on("drag",function(e){s.state.justDragged=!0,s.dragmove.call(s,e)}),d3.select(window).on("keydown",function(){s.svgKeyDown.call(s)}).on("keyup",function(){s.svgKeyUp.call(s)}),e.on("mousedown",function(e){s.svgMouseDown.call(s,e)}),e.on("mouseup",function(e){s.svgMouseUp.call(s,e)}),d3.select("#start-simulation").on("click",function(){s.state.simulationStarted=!0,console.log(JSON.stringify(s.nodes)),console.log(JSON.stringify(s.edges));var e=[];s.edges.forEach(function(n){e.push({source:n.source.id,target:n.target.id,value:"40"})});var n=JSON.stringify(e);s.instance=new Module.AntColonyJSON(s.nodes.length,n,1,0);var t=JSON.parse(s.instance.nextStep(5));console.log(JSON.stringify(t));for(var l=0;l<s.edges.length;l++)s.edges[l].value=t[l].value;console.log(JSON.stringify(s.edges)),d3.select("#next-step").attr("disabled",null),s.updateGraph()}),d3.select("#next-step").on("click",function(){var e=JSON.parse(s.instance.nextStep(5));console.log(JSON.stringify(e));for(var n=0;n<s.edges.length;n++)s.edges[n].value=e[n].value;console.log(JSON.stringify(s.edges)),s.updateGraph()})};AntGraph.prototype.setIdCt=function(e){this.idct=e},AntGraph.prototype.consts={selectedClass:"selected",connectClass:"connect-node",circleGClass:"node",graphClass:"graph",activeEditId:"active-editing",BACKSPACE_KEY:8,DELETE_KEY:46,ENTER_KEY:13,nodeRadius:10},AntGraph.prototype.dragmove=function(e){var n=this;n.state.shiftNodeDrag?(e.x+=d3.event.dx,e.y+=d3.event.dy,n.updateGraph()):n.dragLine.attr("d","M"+e.x+","+e.y+"L"+d3.mouse(n.svgG.node())[0]+","+d3.mouse(this.svgG.node())[1])},AntGraph.prototype.deleteGraph=function(e){var n=this,t=!0;e||(t=window.confirm("Press OK to delete this graph")),t&&(n.nodes=[],n.edges=[],n.updateGraph())},AntGraph.prototype.spliceLinksForNode=function(e){var n=this,t=n.edges.filter(function(n){return n.source===e||n.target===e});t.map(function(e){n.edges.splice(n.edges.indexOf(e),1)})},AntGraph.prototype.replaceSelectEdge=function(e,n){var t=this;e.classed(t.consts.selectedClass,!0),t.state.selectedEdge&&t.removeSelectFromEdge(),t.state.selectedEdge=n},AntGraph.prototype.replaceSelectNode=function(e,n){var t=this;e.classed(this.consts.selectedClass,!0),t.state.selectedNode&&t.removeSelectFromNode(),t.state.selectedNode=n},AntGraph.prototype.removeSelectFromNode=function(){var e=this;e.circles.filter(function(n){return n.id===e.state.selectedNode.id}).classed(e.consts.selectedClass,!1),e.state.selectedNode=null},AntGraph.prototype.removeSelectFromEdge=function(){var e=this;e.paths.filter(function(n){return n===e.state.selectedEdge}).classed(e.consts.selectedClass,!1),e.state.selectedEdge=null},AntGraph.prototype.pathMouseDown=function(e,n){var t=this,s=t.state;d3.event.stopPropagation(),s.mouseDownLink=n,s.selectedNode&&t.removeSelectFromNode();var l=s.selectedEdge;l&&l===n?t.removeSelectFromEdge():t.replaceSelectEdge(e,n)},AntGraph.prototype.circleMouseDown=function(e,n){var t=this,s=t.state;d3.event.stopPropagation(),s.mouseDownNode=n,d3.event.shiftKey?s.shiftNodeDrag=d3.event.shiftKey:t.dragLine.classed("hidden",!1).attr("d","M"+n.x+","+n.y+"L"+n.x+","+n.y)},AntGraph.prototype.circleMouseUp=function(e,n){var t=this,s=t.state,l=t.consts;s.shiftNodeDrag=!1,e.classed(l.connectClass,!1);var a=s.mouseDownNode;if(a){if(t.dragLine.classed("hidden",!0),a!==n){var r={source:a,target:n,value:"40"},u=t.paths.filter(function(e){return e.source===r.target&&e.target===r.source&&t.edges.splice(t.edges.indexOf(e),1),e.source===r.source&&e.target===r.target});u[0].length||(t.edges.push(r),t.updateGraph())}else if(s.justDragged)s.justDragged=!1;else{s.selectedEdge&&t.removeSelectFromEdge();var c=s.selectedNode;c&&c.id===n.id?t.removeSelectFromNode():t.replaceSelectNode(e,n)}s.mouseDownNode=null}},AntGraph.prototype.svgMouseDown=function(){this.state.graphMouseDown=!0},AntGraph.prototype.svgMouseUp=function(){var e=this,n=e.state;if(n.justScaleTransGraph)n.justScaleTransGraph=!1;else if(n.graphMouseDown&&d3.event.shiftKey){var t=d3.mouse(e.svgG.node()),s={id:e.idct++,type:0,x:t[0],y:t[1]};e.nodes.push(s),d3.select("#next-step").attr("disabled","disabled"),e.updateGraph()}else n.shiftNodeDrag=!1,e.dragLine.classed("hidden",!0);n.graphMouseDown=!1},AntGraph.prototype.svgKeyDown=function(){var e=this,n=e.state,t=e.consts;if(-1===n.lastKeyDown){n.lastKeyDown=d3.event.keyCode;var s=n.selectedNode,l=n.selectedEdge;switch(d3.event.keyCode){case t.BACKSPACE_KEY:case t.DELETE_KEY:d3.event.preventDefault(),s?(e.nodes.splice(e.nodes.indexOf(s),1),e.spliceLinksForNode(s),n.selectedNode=null,e.updateGraph()):l&&(e.edges.splice(e.edges.indexOf(l),1),n.selectedEdge=null,e.updateGraph())}}},AntGraph.prototype.svgKeyUp=function(){this.state.lastKeyDown=-1},AntGraph.prototype.updateGraph=function(){var e=this,n=e.consts,t=e.state;e.paths=e.paths.data(e.edges,function(e){return String(e.source.id)+"+"+String(e.target.id)});var s=e.paths;s.classed(n.selectedClass,function(e){return e===t.selectedEdge}).classed("link0",function(e){return 0==e.value}).classed("link1",function(e){return 1==e.value}).classed("link2",function(e){return 2==e.value}).classed("link3",function(e){return 3==e.value}).classed("link4",function(e){return 4==e.value}).classed("link5",function(e){return 5==e.value}).classed("link6",function(e){return 6==e.value}).classed("link7",function(e){return 7==e.value}).classed("link8",function(e){return 8==e.value}).classed("link9",function(e){return 9==e.value}).classed("link10",function(e){return 10==e.value}).classed("link11",function(e){return 11==e.value}).classed("link12",function(e){return 12==e.value}).classed("link13",function(e){return 13==e.value}).classed("link14",function(e){return 14==e.value}).classed("link15",function(e){return 15==e.value}).classed("link16",function(e){return 16==e.value}).classed("link17",function(e){return 17==e.value}).classed("link18",function(e){return 18==e.value}).classed("link19",function(e){return 19==e.value}).classed("link20",function(e){return 20==e.value}).classed("link21",function(e){return 21==e.value}).classed("link22",function(e){return 22==e.value}).classed("link23",function(e){return 23==e.value}).classed("link24",function(e){return 24==e.value}).classed("link25",function(e){return 25==e.value}).classed("link26",function(e){return 26==e.value}).classed("link27",function(e){return 27==e.value}).classed("link28",function(e){return 28==e.value}).classed("link29",function(e){return 29==e.value}).classed("link30",function(e){return 30==e.value}).classed("link31",function(e){return 31==e.value}).classed("link32",function(e){return 32==e.value}).classed("link33",function(e){return 33==e.value}).classed("link34",function(e){return 34==e.value}).classed("link35",function(e){return 35==e.value}).classed("link36",function(e){return 36==e.value}).classed("link37",function(e){return 37==e.value}).classed("link38",function(e){return 38==e.value}).classed("link39",function(e){return 39==e.value}).classed("link40",function(e){return 40==e.value}).classed("link41",function(e){return 41==e.value}).classed("link42",function(e){return 42==e.value}).classed("link43",function(e){return 43==e.value}).classed("link44",function(e){return 44==e.value}).classed("link45",function(e){return 45==e.value}).classed("link46",function(e){return 46==e.value}).classed("link47",function(e){return 47==e.value}).classed("link48",function(e){return 48==e.value}).classed("link49",function(e){return 49==e.value}).classed("link50",function(e){return 50==e.value}).classed("link51",function(e){return 51==e.value}).classed("link52",function(e){return 52==e.value}).classed("link53",function(e){return 53==e.value}).classed("link54",function(e){return 54==e.value}).classed("link55",function(e){return 55==e.value}).classed("link56",function(e){return 56==e.value}).classed("link57",function(e){return 57==e.value}).classed("link58",function(e){return 58==e.value}).classed("link59",function(e){return 59==e.value}).classed("link60",function(e){return 60==e.value}).classed("link61",function(e){return 61==e.value}).classed("link62",function(e){return 62==e.value}).classed("link63",function(e){return 63==e.value}).classed("link64",function(e){return 64==e.value}).classed("link65",function(e){return 65==e.value}).classed("link66",function(e){return 66==e.value}).classed("link67",function(e){return 67==e.value}).classed("link68",function(e){return 68==e.value}).classed("link69",function(e){return 69==e.value}).classed("link70",function(e){return 70==e.value}).classed("link71",function(e){return 71==e.value}).classed("link72",function(e){return 72==e.value}).classed("link73",function(e){return 73==e.value}).classed("link74",function(e){return 74==e.value}).classed("link75",function(e){return 75==e.value}).classed("link76",function(e){return 76==e.value}).classed("link77",function(e){return 77==e.value}).classed("link78",function(e){return 78==e.value}).classed("link79",function(e){return 79==e.value}).classed("link80",function(e){return 80==e.value}).classed("link81",function(e){return 81==e.value}).classed("link82",function(e){return 82==e.value}).classed("link83",function(e){return 83==e.value}).classed("link84",function(e){return 84==e.value}).classed("link85",function(e){return 85==e.value}).classed("link86",function(e){return 86==e.value}).attr("d",function(e){return"M"+e.source.x+","+e.source.y+"L"+e.target.x+","+e.target.y}),s.enter().append("path").classed("link",!0).classed("link40",function(e){return 40==e.value}).classed("link100",function(e){return 100==e.value}).attr("d",function(e){return"M"+e.source.x+","+e.source.y+"L"+e.target.x+","+e.target.y}).on("mousedown",function(n){e.pathMouseDown.call(e,d3.select(this),n)}).on("mouseup",function(e){t.mouseDownLink=null}),s.exit().remove(),e.circles=e.circles.data(e.nodes,function(e){return e.id}),e.circles.attr("transform",function(e){return"translate("+e.x+","+e.y+")"});var l=e.circles.enter().append("g");l.classed("source",function(e){return 1==e.type}).classed("target",function(e){return 2==e.type}).classed(n.circleGClass,function(e){return 1!=e.type&&2!=e.type}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).on("mouseover",function(e){t.shiftNodeDrag&&d3.select(this).classed(n.connectClass,!0)}).on("mouseout",function(e){d3.select(this).classed(n.connectClass,!1)}).on("mousedown",function(n){e.circleMouseDown.call(e,d3.select(this),n)}).on("mouseup",function(n){e.circleMouseUp.call(e,d3.select(this),n)}).call(e.drag),l.append("circle").attr("r",String(n.nodeRadius)),e.circles.exit().remove()};var graph,docEl=document.documentElement,bodyEl=document.getElementsByTagName("body")[0],width=600,height=550,xLoc=width/2,yLoc=50,nodes=[{id:0,type:2,x:xLoc,y:yLoc},{id:1,type:1,x:xLoc,y:yLoc+450}],edges=[],svg=d3.select("#simulator").append("svg").attr("id","chart").attr("width",width).attr("height",height);graph=new AntGraph(svg,nodes,edges),graph.setIdCt(2),graph.updateGraph();